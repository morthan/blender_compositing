Пример композитинга
-------------------

Глава подходит к концу и под занавес я покажу пример композитинга: совмещения
двух разных изображений. Сделано сие будет коряво и на скорую руку, но ведь это
только начало!

Итак, у нас имеется фотография пейзажа (гора Демерджи из моих крымских запасов),
представленная на рисунке 2.37.

image:img/figure2_37.jpg[]

*Рисунок 2.37* 'Фоновое изображение'

На эту фотографию мы наложим ребёнка, тщательно вырезанного мною из фотографии с
помощью Gimp и сохранённого в формате *PNG*. Такой формат был выбран потому, что
он поддерживает прозрачность.

image:img/figure2_38.png[]

*Рисунок 2.38* 'Персонаж для совмещения'

Приступим, значится. Запустим Blender, удалим кубик по умолчанию и правильно
выставим камеру (см. предыдущий раздел). Сохраним файл, назвав его, к примеру
`compositing.blend`, после чего скопируем в папку с файлом обе картинки, чтобы
они были поближе и никуда не терялись.

Разделим окно 3D-вида пополам и переключим одну половину на вид из камеры
(клавиша *0* на цифровой клавиатуре). Зададим для этого 3D-вида фоновое
изображение `demergi.jpg`. Обратите внимание -- картинка аккуратно выровнялась
по границам вида из камеры.

image:img/figure2_39.jpg[]

*Рисунок 2.39* 'Задание фоновой картинки 3D-вида'

То, что мы задали фоновую картинку, никак не влияет на конечный результат. В
этом легко убедиться, нажав *F12* -- перед нами пустой экран. Исправим это!
Переключимся в контекст *Scene* (клавиша *F10*) и там на вкладке *Output*
включим использование фонового изображения для рендеринга (см. рис. 2.40).
Нажмём *F12* и увидим фоновую картинку, пока без изменений. Сохраним blend-файл
и продолжим.

image:img/figure2_40.png[]

*Рисунок 2.40* 'Задание фонового изображения для рендеринга'

Добавляем проекционную плоскость (пробел -> *Add* -> *Mesh* -> *Plane*) и задаём
её размеры (0.798x2.418). Делаем пробный рендеринг: теперь поверх фоновой
картинки располагается пустой серый прямоугольник нашей проекционной плоскости.

image:img/figure2_41.jpg[]

*Рисунок 2.41* 'Добавленная проекционная плоскость'

Серый прямоугольник нам не нужен. Нам нужна фотография ребёнка, причём,
желательно, с поддержкой прозрачности. А для этого необходимо добавить
'материал'.

Переключаемся на контекст *Shading* (клавиша *F5*) и в панели *Links and
Pipeline* нажимаем кнопку *ADD NEW*. Теперь нашей плоскости назначен материал,
свойства которого можно редактировать. Для начала нажмём в панели *Material*
кнопки *A* (включает поддержку прозрачности), *Shadeless* (убирает влияние
источников света) и *TextFace* (не знаю, что она делает, но без неё почему-то не
работает), а в панели *Texture* -- кнопку *Add new*. Это добавит нашему
материалу новую текстуру.

image:img/figure2_42.png[]

*Рисунок 2.42* 'Начало настройки материала проекционной плоскости'

Переходим к настройке текстуры. Для этого переходим в подконтекст *Texture*
(клавиша *F6*), где выбираем из списка тип нашей текстуры -- *Image*. В
появившейся панели *Image* нажимаем кнопку *Load* и выбираем файл `pavlik.png`.
Картинка загружается и появляется в окошке предпросмотра.

Поскольку окно предпросмотра квадратное, а наша картинка вытянута по вертикали,
то она кажется искажённой. Но это поправимо. Нажмём пару кнопок: *Premul* в
панели *Image* (включает предумноженный режим прозрачности, про который будет
рассказано потом) и *Alpha* в панели *Preview* (отображает прозрачные участки в
виде знакомой «шахматки»), после чего возвращаемся обратно в подконтекст
*Material* для дальнейшей настройки материала.

image:img/figure2_43.png[]

*Рисунок 2.43* 'Настройка текстуры изображения'

Материалы по умолчанию отображаются на сфере. Нам же нужна плоскость, поэтому
нажмём в панели *Preview* кнопку с квадратиком. Теперь предпросмотр материала
принимает осмысленные очертания. Нажмём клавишу *F12* и увидим, что теперь на
проекционной плоскости появилась текстура с ребёнком: неискажённая, хоть и без
прозрачности. Сохраним blend-файл на данном этапе и перейдём к добавлению
прозрачности.

Для этого нам потребуется сделать так называемую UV-развёртку. Что это такое
будет рассказано в главе про материалы, а пока просто выполним определённую
последовательность действий.

Измените тип второго окна 3D-вида на *UV/Image editor*. Теперь в первом окне
3D-вида (где вид из камеры) переключитесь клавишей *Tab* в режим редактирования.
Очертания проекционной плоскости приобретут характерный жёлтый цвет. Нажмите
клавишу *U* и в появившемся меню выберите *Unwrap*. В окне редактора
UV/изображений появится жёлтый квадрат, стороны которого соответствуют сторонам
нашей проекционной плоскости. Изображения там пока нет, но сейчас мы это
исправим.

image:img/figure2_44.jpg[]

*Рисунок 2.44* 'Меню создания UV-развёртки'

В редакторе UV/изображений выберите пункт меню *Image* -> *Open* и загрузите
файл `pavlik.png`. Теперь картинка появилась.

Переходим к дополнительной настройке отображения. В панели *Map Input* нажимаем
кнопку *UV*, а в панели *Map To* -- кнопки *Col* и *Alpha*. Таким образом,
текстура будет накладываться на плоскость по алгоритму *UV* и воздействовать на
цвет и прозрачность.

image:img/figure2_45.png[]

*Рисунок 2.45* 'Окончательная настройка свойств текстуры'

Вернёмся в 3D-вид и выключим режим редактирования клавишей *Tab*. Для
наглядности включим текстурный режим отображения (см. рис. 2.46). Хм... картинка
на плоскости почему-то перевёрнута. Не страшно -- перевернём саму плоскость
клавишей *R*. Тестовый рендер также показывает, что всё нормально.

image:img/figure2_46.png[]

*Рисунок 2.46* 'Текстурный режим отображения'

Ну и финал, так сказать. Путём перемещения, масштабирования и вращения
проекционной плоскости, выставляем её в нужное место. Рендерим. Получаем
результат.

image:img/figure2_47.jpg[]

*Рисунок 2.47* 'Финальный рендер'

Конечный результат выглядит коряво. Тому есть несколько причин: у картинок
разное разрешение; снимались они в разных условиях и при разном освещении;
никакой цветокоррекции не производилось... Исправить это, обычно, можно. Но не
всё же сразу!

Итоги подведём. С помощью Blender мы очень хитро и нетрадиционно сделали то, что
умеет любой фотошопщик. Казалось бы, фиаско? Но есть нюансы. Во-первых,
фотошопщик тоже когда-то начинал с чего-то подобного. Во-вторых, для
+++<em>статических</em>+++ картинок Photoshop, конечно, лучше. Но мы будем заниматься
композитингом видео, а это «две большие разницы».

Ну и в-третьих, мы ещё только учимся!
