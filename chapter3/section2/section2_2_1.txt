Joint Photographic Experts Group (JPEG)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Этот формат был создан для сжатия фотографий (которые очень плохо поддаются
сжатию без потерь). Поэтому он не поддерживает прозрачности, зато хорошо
поддерживает цвет -- 24 бита глубины.

Для сжатия используются особенности человеческого восприятия. В частности,
изменения в 'яркости' человек воспринимает очень хорошо, а вот аналогичные по
величине изменения 'цветности' уже нет. Поэтому слабо различающиеся цвета можно
усреднять, приводя к общему знаменателю. Для этого есть разные способы, а JPEG
пользуется так называемым «дискретным косинусным преобразованием», позволяющим
регулировать степень сжатия в широких пределах.

Вообще-то математический аппарат там довольно сложен для понимания, поэтому
объясним детали «на пальцах».

Сначала всё изображение переводится в цветовое пространство YUV, чтобы отделить
яркость от цветности. Далее яркость и цветность обрабатываются отдельно.

Слой яркости сжимается с минимальными потерями (для упрощения будем считать, что
не сжимается вообще), поскольку изменения в яркости зритель вычислит
моментально.

Цветовая информация же разбивается на блоки 8x8 пикселей, каждый из которых
сжимается отдельно. 64 пикселя, составляющие блок, «разворачиваются» в строчку.
Если значение каждого пикселя строчки представить числом и построить график, то
мы увидим волнистую линию. Чисто теоретически можно подобрать функцию, график
которой точно будет соответствовать этой линии. На практике существует формула
со многими составляющими, правильно подставляя в которую коэффициенты можно
добиться того, что график этой функции будет 'похож' на заданный. Чем больше
коэффициентов -- тем более похож.

И вот у нас вначале было 64 числа (8*8 пикселей), а стало, допустим, 3
коэффициента, с которыми график 'примерно' похож на то, что было. Не совсем
точно, конечно, но мозг достроит недостающее.

Так и получается сжатие с потерями. При распаковке для каждого блока по
коэффициентам будет построен график, оттуда вытянут 64 цвета для пикселей,
свернут их в блок 8x8, а сверху на всё это наложат яркость. И будет картинка
'примерно' похожая на исходную.

Насколько похожая? А тут всё зависит от количества коэффициентов, которые мы
сохраняем. Можно задать много, и тогда качество будет хорошее, но размер
побольше. А можно сохранять поменьше коэффициентов, и тогда огрубление качества
будет достаточным, чтобы на картинке чётко просматривались границы блоков 8x8
пикселей.

На рисунке 3.3 можно увидеть иллюстрацию этого. Здесь качество JPEGа изменяется
слева направо от самого плохого до самого лучшего.

image:img/figure3_3.png[]

*Рисунок 3.3* 'Пример изменения качества JPEG'

А насколько это сжатие действенно в смысле строгих чисел? Вот небольшая табличка
на эту тему:

.Параметры JPEG с разным сжатием
[width="80%",cols="2,>2,10",options="header"]
|============================================
|Качество      |Размер (байт) |Комментарий
|Высшее (100)  | 83,261       |Артефактов практически нет.
|Высокое (50)  | 15,138       |Начинают появляться мелкие артефакты.
|Среднее (25)  |  9,553       |Артефакты легко заметны, теряются мелкие детали.
|Низкое (10)   |  4,787       |Теряются средние детали, артефакты вокруг
контуров, начинают появляться границы блоков пикселей.

|Наихудшее (1) |  1,523       |Блоки пикселей видны невооружённым глазом, детали
окончательно превращаются в мешанину квадратиков.
|============================================

Резюмируем. JPEG хорошая штука для сжатия фотографий и, при грамотных
настройках, позволяет паковать их очень хорошо и почти без потери качества. Если
небольшие потери нас устраивают, то этим форматом вполне можно пользоваться.
